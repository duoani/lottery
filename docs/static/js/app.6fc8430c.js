(window.webpackJsonp=window.webpackJsonp||[]).push([["app"],{ERIh:function(t,e,i){"use strict";i.r(e);var a={},r=function(t,e){var i=new Image;i.onload=function(){a[t.id]=i,e()},i.src=t.src};var n={load:function t(e,i,a){e[a=a||0]&&r(e[a],function(){i(a,e.length),t(e,i,a+1)})},get:function(t){return a[t]}},s={img:[{id:"plate",src:"./static/img/plate.cae4f04.png"}]},o=[300,300],l={canvas_width:600,canvas_height:600,plate_radius:300,plate_center:o,prize_area_radius:249,prize_title_radius:200,start_btn_radius:30,arrow_vertex_arr:[[o[0]-10,o[1]-20],[o[0],o[1]-80],[o[0]+10,o[1]-20]],rotate_duration:6e3},h=i("b83N"),u=i.n(h),c=i("xjNF"),d=i.n(c),f=["red","orange","yellow","green","blue","purple"];var v=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];u()(this,t),this.prizes=e,this.oriX=l.plate_center[0],this.oriY=l.plate_center[1],this.radius=l.plate_radius,this.rotateDuration=l.rotate_duration,this.rotateDistance=0,this.startRadian=0,this.ctx=null,this.rotating=!1}return d()(t,[{key:"setContext",value:function(t){this.ctx=t,this.currentTime=0}},{key:"start",value:function(){this.render(),this.bindEvents()}},{key:"bindEvents",value:function(){var t=this,e=this.ctx.canvas;e.addEventListener("click",function(e){if(!t.rotating&&(t.rotating=!0,t.isInBtn(e))){t.startRadian=0;var i=t.distanceToStop();t.startRotate(i)}}),e.addEventListener("mousemove",function(i){t.isInBtn(i)?e.style.cursor="pointer":e.style.cursor="default"})}},{key:"isInBtn",value:function(t){var e=this.windowToCanvas(t);return Math.sqrt(Math.pow(e.x-this.oriX,2)+Math.pow(e.y-this.oriY,2))<l.start_btn_radius}},{key:"startRotate",value:function(t){this._lastTime=Date.now(),this.currentTime=0,this.rotateDistance=t,this.rotate(0)}},{key:"rotate",value:function(t){var e=this,i=this.rotateDistance;this.currentTime+=t,this.startRadian=function(t,e,i,a){return(t/=a/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e}(this.currentTime,0,this.rotateDistance,this.rotateDuration),this.startRadian>i&&(this.startRadian=i),this.render(),i-this.startRadian<=.05?this.rotating=!1:setTimeout(function(){var t=Date.now(),i=t-e._lastTime;e._lastTime=t,e.rotate(i)},1e3/60)}},{key:"windowToCanvas",value:function(t){var e=this.ctx.canvas.getBoundingClientRect(),i=t.clientX,a=t.clientY;return{x:i-e.left,y:a-e.top}}},{key:"distanceToStop",value:function(){var t,e=this,i=0,a=this.prizes.map(function(t,i){var a=2*Math.PI/e.prizes.length;return a*i+(a*(i+1)-a*i)/2}),r=Math.floor(Math.random()*this.prizes.length);return console.log("当前奖品应该中的奖品是："+this.prizes[r].title),t=a[r],(i=(i=3*Math.PI/2-t)>0?i:2*Math.PI+i)+100*Math.PI}},{key:"render",value:function(){var t=this.ctx;this.drawPlate(t),this.drawPrizeArea(t),this.drawBtn(t),this.drawArrow(t)}},{key:"drawPlate",value:function(t){t.save(),t.translate(this.oriX,this.oriY),t.rotate(this.startRadian),t.drawImage(n.get("plate"),-this.radius,-this.radius,2*this.radius,2*this.radius),t.restore()}},{key:"drawPrizeArea",value:function(t){for(var e=this.prizes.length,i=2*Math.PI/e,a=this.startRadian,r=0;r<e;r++)t.save(),t.beginPath(),t.fillStyle=f[r%f.length],t.moveTo(this.oriX,this.oriY),t.arc(this.oriX,this.oriY,l.prize_area_radius,a,a+i,!1),t.fill(),t.restore(),t.save(),t.fillStyle="#FFFFFF",t.font="14px Arial",t.translate(l.plate_center[0]+Math.cos(a+i/2)*l.prize_title_radius,l.plate_center[1]+Math.sin(a+i/2)*l.prize_title_radius),t.rotate(a+i/2+Math.PI/2),this.getLineTextList(t,this.prizes[r].title,70).forEach(function(e,i){t.fillText(e,-t.measureText(e).width/2,25*++i)}),t.restore(),a+=i}},{key:"getLineTextList",value:function(t,e,i){for(var a=e.split(""),r="",n=[],s=0;s<a.length;s++)t.measureText(r).width>=i&&(n.push(r),i-=t.measureText(e[0]).width,r=""),r+=a[s];return n.push(r),n}},{key:"drawBtn",value:function(t){t.save(),t.beginPath(),t.fillStyle="#ff0000",t.arc(this.oriX,this.oriY,l.start_btn_radius,0,2*Math.PI,!1),t.fill(),t.restore()}},{key:"drawArrow",value:function(t){var e=l.arrow_vertex_arr;t.save(),t.beginPath(),t.fillStyle="#ff0000",t.moveTo(e[0][0],e[0][1]),t.lineTo(e[1][0],e[1][1]),t.lineTo(e[2][0],e[2][1]),t.closePath(),t.fill(),t.restore()}}]),t}(),p=[{title:"奖品一"},{title:"奖品二"},{title:"奖品三"},{title:"奖品四"},{title:"奖品五"},{title:"奖品六"},{title:"奖品七"},{title:"奖品八"},{title:"奖品九"},{title:"奖品十"},{title:"奖品十一"},{title:"奖品十二"}];console.log("start load"),n.load(s.img,function(t,e){console.log("=====",t),t===e-1&&function(){var t=document.querySelector("#game-canvas");t.width=l.canvas_width,t.height=l.canvas_height;var e=t.getContext("2d"),i=new v(p);i.setContext(e),i.start()}()})},b83N:function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},xjNF:function(t,e){function i(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}t.exports=function(t,e,a){return e&&i(t.prototype,e),a&&i(t,a),t}}},[["ERIh","runtime"]]]);